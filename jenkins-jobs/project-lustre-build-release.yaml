---
- project:
    name: 'project-lustre-build-release'
    branch:
      - 'master'
    distro:
      - 'rhel8.8':
          kernel_version: 4.18
    jobs:
      - '{name}-{distro}-{branch}'

- job-template:
    # default var values
    branch: 'master'
    build_linux: 'yes'

    name: '{name}-{distro}-{branch}'
    node: 'build-agent-{distro}'

    parameters:
      - string:
          name: 'BRANCH'
          default: '{branch}'
          description: 'branch to build'
      - string:
          name: 'BUILD_LINUX'
          default: '{build_linux}'
          description: 'build linux kernel: yes or no'
      - string:
          name: 'EXTRA_PATCHES'
          default: '47563, 47812'
          description: "comma separated list of patch numeric ids. Which haven't been merged yet.
            E.g.: For change https://review.whamcloud.com/#/c/47004/, the patch number id is 47004"
      - string:
          name: 'TARGET'
          default: '{kernel_version}-{distro}'
          description: 'Target to build, e.g.: 4.18-rhel8.8, 5.10-oe2203sp1
            See https://github.com/lustre/lustre-release/tree/master/lustre/kernel_patches/targets'

    builders:
      - shell:
          !include-raw-escape: scripts/build-lustre-release.sh
    publishers:
      - groovy-postbuild:
          script: |
            def summary = manager.createSummary("package.gif")
            summary.appendText("See <a href=https://uk.linaro.cloud/repo/lustre/>RPM release repo.</a>", false)
